var CBL=function(g){var s={preprocess:function(){C("You should define a preprocess method!")},model_file:"",model_string:"",model_loaded:function(){},training_complete:function(){},blob_min_pixels:1,blob_max_pixels:99999,pattern_width:20,pattern_height:20,pattern_maintain_ratio:false,pattern_auto_rotate:false,incorrect_segment_char:"\\",blob_debug:"",blob_console_debug:false,allow_console_log:false,allow_console_warn:true,perceptive_colorspace:false,character_set:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",fixed_blob_locations:[],exact_characters:-1};g=g||{};for(var b in s){if(s.hasOwnProperty(b)&&!g.hasOwnProperty(b)){g[b]=s[b]}}var u={solve:function(G){return u.train(G,true)},done:function(G){x(function(){G(w);o()})},train:function(G,H){if(typeof H==="undefined"){H=false}x(function(){var J;var I=false;if(document.getElementById(G)!=null){J=document.getElementById(G)}else{J=document.createElement("img");I=true}var K=function(){var L="";var M=document.createElement("canvas");M.width=J.width;M.height=J.height;M.getContext("2d").drawImage(J,0,0);var O=new z(M);g.preprocess(O);var R;if(g.fixed_blob_locations.length>0){R=O.segmentBlocks(g.pattern_width,g.pattern_height,g.fixed_blob_locations,g.blob_debug)}else{R=O.segmentBlobs(g.blob_min_pixels,g.blob_max_pixels,g.pattern_width,g.pattern_height,g.blob_debug)}if(!H){for(var N=0;N<R.length;N++){var Q=R[N].toDataURL();var P=t(R[N]);B.push({imgSrc:Q,pattern:P,imgId:j,txtId:f,self:u,onComplete:g.training_complete})}if(!F){u.loadNextPattern()}F=true}else{for(var N=0;N<R.length;N++){L+=m(t(R[N]))}p("Solution = "+L)}w=L;o()};if(J.complete&&!I){K()}else{J.onload=K;if(I){J.src=G}}});return this},loadNextPattern:function(){var G=B.pop();if(G){p("Loading a pattern for human classification.");A();document.getElementById(G.imgId).src=G.imgSrc;document.getElementById(G.txtId).focus();document.getElementById(G.txtId).onkeyup=function(H){var I=document.getElementById(G.txtId).value;if((g.character_set.indexOf(I)>-1&&I.length)||I==g.incorrect_segment_char){if(I!=g.incorrect_segment_char){h.push({pattern:G.pattern,solution:document.getElementById(G.txtId).value});p('Added "'+document.getElementById(G.txtId).value+'" pattern to model!')}else{p("Did not add bad segment to model.")}document.getElementById(G.txtId).value="";if(B.length){G.self.loadNextPattern()}else{F=false;document.getElementById(G.txtId).onkeyup=function(){};if(typeof G.onComplete==="function"){G.onComplete();e()}}}else{document.getElementById(G.txtId).value=""}}}},loadModelString:function(J){J=v.decompressFromBase64(J);h=new Array();var I=J.replace(/\[/g,"").split("]");for(var G=0;G<I.length;G++){var L=I[G].split("=");if(L.length==2){var K=L[1];var H=L[0];h.push({pattern:K,solution:H})}}if(!h.length){C("No patterns to load in provided model.")}else{p("Model loaded with "+h.length+" patterns!");g.model_loaded()}},loadModel:function(G){try{var I=new XMLHttpRequest();I.open("GET",G,true);I.send();I.onreadystatechange=function(){if(I.readyState==4&&I.status==200&&I.responseText){u.loadModelString(I.responseText)}}}catch(H){C('Could not load model from "'+G+'"! ('+H.message+")")}},serializeModel:function(){var H="";for(var G=0;G<h.length;G++){H+="["+h[G].solution+"="+h[G].pattern+"]"}H=v.compressToBase64(H);return H},saveModel:function(){var H=u.serializeModel();var G=document.createElement("a");G.href="data:application/octet-stream,"+encodeURIComponent(H);G.setAttribute("download","cbl-model.dat");G.click()},debugModel:function(){for(var G=0;G<h.length;G++){p(h[G].solution+" pattern length = "+h[G].pattern.split(".").length)}},sortModel:function(){h=h.sort(function(H,G){return H.solution.localeCompare(G.solution)})},visualizeModel:function(J){for(var H=0;H<h.length;H++){var L=document.createElement("canvas");L.width=g.pattern_width;L.height=g.pattern_height;var N=L.getContext("2d").getImageData(0,0,g.pattern_width,g.pattern_height);var P=h[H].pattern.split(".");for(var O=0;O<g.pattern_width;O++){for(var M=0;M<g.pattern_height;M++){var I=O*4+M*4*g.pattern_width;var G=M+O*g.pattern_width;N.data[I]=P[G];N.data[I+1]=P[G];N.data[I+2]=P[G];N.data[I+3]=255}}L.getContext("2d").putImageData(N,0,0);var K=document.createElement("img");K.src=L.toDataURL();document.getElementById(J).appendChild(K)}},condenseModel:function(){var L=new Array();var I=h.length;for(var K=0;K<h.length;K++){var H=h[K].pattern.split(".");var M=false;for(var J=0;J<L.length;J++){if(L[J].solution==h[K].solution){for(var G=0;G<L[J].tempArray.length;G++){L[J].tempArray[G]=parseInt(L[J].tempArray[G])+parseInt(H[G])}L[J].tempCount++;M=true;break}}if(!M){L.push({pattern:h[K].pattern,solution:h[K].solution,tempArray:H,tempCount:1})}}for(var K=0;K<L.length;K++){for(var G=0;G<L[K].tempArray.length;G++){L[K].tempArray[G]=Math.round(L[K].tempArray[G]/L[K].tempCount)}L[K].pattern=L[K].tempArray.join(".")}h=L;p("Condensed model from "+I+" patterns to "+h.length+" patterns!");return this}};var z=function(G){var H={colorRegions:function(K,N,P){if(typeof N==="undefined"){N=false}if(typeof P==="undefined"){P=0}var J=new Array();var M=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var I=0;I<M.width;I++){for(var O=0;O<M.height;O++){var L=I*4+O*4*M.width;if(!D(J,L)){H.floodfill(I,O,y(),K,M,J,N,P)}}}G.getContext("2d").putImageData(M,0,0);return this},display:function(I){document.getElementById(I).src=G.toDataURL();return this},debugImage:function(I){var J=document.createElement("img");J.src=G.toDataURL();document.getElementById(I).appendChild(J);return this},floodfill:function(O,M,ad,Y,T,aa,W,R){var U=false;if(typeof T==="undefined"){U=true;T=G.getContext("2d").getImageData(0,0,G.width,G.height)}if(typeof R==="undefined"){R=0}var ac=T.data;var J=ac.length;var K=[];var X=(O+M*T.width)*4;var Z=X,P=X,ab,S,N=T.width*4;var I=[ac[X],ac[X+1],ac[X+2],ac[X+3]];var L=ac[X]+ac[X+1]+ac[X+2]+ac[X+3];if(!a(X,I,L,ad,ac,J,Y)){return false}K.push(X);while(K.length){X=K.pop();if(typeof aa!=="undefined"){if(D(aa,X)){continue}}if(r(X,I,L,ad,ac,J,Y,aa,W)){Z=X;P=X;S=(X/N)*N;ab=S+N;while(S<(P-=4)&&r(P,I,L,ad,ac,J,Y,aa,W)){}while(ab>(Z+=4)&&r(Z,I,L,ad,ac,J,Y,aa,W)){}if(R>0){P-=R*4;Z+=R*4}for(var V=P;V<Z;V+=4){if(V-N>=0&&a(V-N,I,L,ad,ac,J,Y)){K.push(V-N)}if(V+N<J&&a(V+N,I,L,ad,ac,J,Y)){K.push(V+N)}}}}if(U){G.getContext("2d").putImageData(T,0,0)}},blur:function(I){if(typeof I==="undefined"){I=1}if(I==2){return this.convolute([[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],1/25)}else{if(I==3){return this.convolute([[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1]],1/49)}else{return this.convolute([[1,1,1],[1,1,1],[1,1,1]],1/9)}}},sharpen:function(){return this.convolute([[0,-1,0],[-1,5,-1],[0,-1,0]])},grayscale:function(){var L=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var I=0;I<L.width;I++){for(var M=0;M<L.height;M++){var J=I*4+M*4*L.width;var K=0.34*L.data[J]+0.5*L.data[J+1]+0.16*L.data[J+2];L.data[J]=K;L.data[J+1]=K;L.data[J+2]=K;L.data[J+3]=255}}G.getContext("2d").putImageData(L,0,0);return this},removeGray:function(J){var M=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var I=0;I<M.width;I++){for(var N=0;N<M.height;N++){var K=I*4+N*4*M.width;var L=Math.max(Math.abs(M.data[K]-M.data[K+1]),Math.abs(M.data[K+1]-M.data[K+2]),Math.abs(M.data[K+2]-M.data[K]));if(L<J){M.data[K]=255;M.data[K+1]=255;M.data[K+2]=255;M.data[K+3]=255}}}G.getContext("2d").putImageData(M,0,0);return this},binarize:function(J){var M=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var I=0;I<M.width;I++){for(var N=0;N<M.height;N++){var K=I*4+N*4*M.width;var L=0.34*M.data[K]+0.5*M.data[K+1]+0.16*M.data[K+2];M.data[K]=L>=J?255:0;M.data[K+1]=L>=J?255:0;M.data[K+2]=L>=J?255:0;M.data[K+3]=255}}G.getContext("2d").putImageData(M,0,0);return this},convolute:function(V,R){var K=G.getContext("2d").getImageData(0,0,G.width,G.height);var N=G.getContext("2d").getImageData(0,0,G.width,G.height);var X=V[0].length;var O=V.length;var Y=Math.floor(O/2);if(typeof R==="undefined"){R=1}var Q=0;for(var T=0;T<K.height-1;T++){for(var U=0;U<K.width-1;U++){var W=U*4+T*4*K.width;var I=0;var P=0;var S=0;for(var J=0;J<X;J++){for(var M=0;M<O;M++){var L=((T+(J-Y))*K.width+(U+(M-Y)))*4;I+=K.data[(L+K.data.length)%K.data.length]*V[J][M];P+=K.data[(L+1+K.data.length)%K.data.length]*V[J][M];S+=K.data[(L+2+K.data.length)%K.data.length]*V[J][M]}}N.data[W+0]=R*I+Q;N.data[W+1]=R*P+Q;N.data[W+2]=R*S+Q;N.data[W+3]=255}}G.getContext("2d").putImageData(N,0,0);return this},erode:function(){return this.convolute([[-1,-1,-1],[-1,8,-1],[-1,-1,-1]])},foreach:function(L){var M=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var I=0;I<M.width;I++){for(var N=0;N<M.height;N++){var K=I*4+N*4*M.width;var J={r:M.data[K+0],g:M.data[K+1],b:M.data[K+2]};J=L(J);M.data[K+0]=J.r;M.data[K+1]=J.g;M.data[K+2]=J.b;M.data[K+3]=255}}G.getContext("2d").putImageData(M,0,0);return this},invert:function(I){return this.foreach(function(J){J.r=255-J.r;J.g=255-J.g;J.b=255-J.b;return J})},cropRelative:function(M,L,J,I){var K=G.getContext("2d").getImageData(M,L,G.width-M-J,G.height-L-I);G.width=G.width-M-J;G.height=G.height-L-I;G.getContext("2d").putImageData(K,0,0);return this},getPixel:function(I,M){var L=G.getContext("2d").getImageData(0,0,G.width,G.height);var K=I*4+M*4*L.width;var J={r:L.data[K+0],g:L.data[K+1],b:L.data[K+2]};return J},segmentBlocks:function(V,K,T,U){if(typeof V==="undefined"){V=20}if(typeof K==="undefined"){K=20}if(typeof T==="undefined"){T=[]}var Q=G.getContext("2d").getImageData(0,0,G.width,G.height);var Z=new Array();for(var aa=0;aa<T.length;aa++){var I=document.createElement("canvas");I.width=Q.width;I.height=Q.height;var S=I.getContext("2d").getImageData(0,0,G.width,G.height);var L=S.data;var R=0;var M=T[aa].x1;var W=T[aa].x2;var N=T[aa].y1;var P=T[aa].y2;var Y=document.createElement("canvas");Y.width=W-M+1;Y.height=P-N+1;Y.getContext("2d").putImageData(Q,-M,-N,M,N,Y.width,Y.height);I.width=V;I.height=K;if(g.pattern_maintain_ratio){var J=Y.width;var O=Y.height;if(J/V>O/K){I.getContext("2d").drawImage(Y,0,0,V,O*(V/J))}else{I.getContext("2d").drawImage(Y,0,0,J*(K/O),K)}}else{I.getContext("2d").drawImage(Y,0,0,V,K)}Z.push(I);if(typeof U!=="undefined"&&U.length){if(g.blob_console_debug){p("Blob size = "+R)}var X=document.createElement("img");X.src=I.toDataURL();document.getElementById(U).appendChild(X)}}return Z},segmentBlobs:function(ai,af,ah,P,ae){if(typeof ai==="undefined"){ai=1}if(typeof af==="undefined"){af=100000}if(typeof ah==="undefined"){ah=20}if(typeof P==="undefined"){P=20}var ab=G.getContext("2d").getImageData(0,0,G.width,G.height);var L=function(ap,ao){return ap[ao]*255*255+ap[ao+1]*256+ap[ao+2]};var V=new Array();for(var W=0;W<ab.width;W++){for(var U=0;U<ab.height;U++){var aj=W*4+U*4*ab.width;var J=L(ab.data,aj);if(!D(V,J)){V.push(J)}}}var am=new Array();for(var an=0;an<V.length;an++){var K=document.createElement("canvas");K.width=ab.width;K.height=ab.height;var ac=K.getContext("2d").getImageData(0,0,G.width,G.height);var R=ac.data;var aa=0;var S=ab.width;var ag=0;var X=ab.height;var Z=0;for(var W=0;W<ab.width;W++){for(var U=0;U<ab.height;U++){var aj=W*4+U*4*ab.width;var J=L(ab.data,aj);if(J==V[an]){R[aj]=0;R[aj+1]=0;R[aj+2]=0;R[aj+3]=255;aa++;if(W<S){S=W}if(W>ag){ag=W}if(U<X){X=U}if(U>Z){Z=U}}else{R[aj]=255;R[aj+1]=255;R[aj+2]=255;R[aj+3]=255}}}if(aa>=ai&&aa<=af){var al=document.createElement("canvas");al.width=ag-S+1;al.height=Z-X+1;al.getContext("2d").putImageData(ac,-S,-X,S,X,al.width,al.height);K.width=ah;K.height=P;K.orig_width=al.width;K.orig_image=al;if(g.pattern_maintain_ratio){var N=al.width;var Y=al.height;if(N/ah>Y/P){K.getContext("2d").drawImage(al,0,0,ah,Y*(ah/N))}else{K.getContext("2d").drawImage(al,0,0,N*(P/Y),P)}}else{K.getContext("2d").drawImage(al,0,0,ah,P)}if(g.pattern_auto_rotate){K=H.histogramRotate(K)}am.push(K)}}if(g.exact_characters>0){while(am.length<g.exact_characters){var Q=0;var M=am[0].orig_width;for(var aj=1;aj<am.length;aj++){if(am[aj].orig_width>M){M=am[aj].orig_width;Q=aj}}for(var ad=1;ad<=2;ad++){var O=l(am[Q].orig_image);var ac=O.getContext("2d").getImageData(0,0,O.width,O.height);S=ad==1?0:O.width/2;ag=ad==1?O.width/2:O.width;X=0;Z=O.height;var al=document.createElement("canvas");al.width=ag-S+1;al.height=Z-X+1;al.getContext("2d").putImageData(ac,-S,-X,S,X,al.width,al.height);O.width=ah;O.height=P;O.orig_width=al.width;O.orig_image=al;if(g.pattern_maintain_ratio){var N=al.width;var Y=al.height;if(N/ah>Y/P){O.getContext("2d").drawImage(al,0,0,ah,Y*(ah/N))}else{O.getContext("2d").drawImage(al,0,0,N*(P/Y),P)}}else{O.getContext("2d").drawImage(al,0,0,ah,P)}if(g.pattern_auto_rotate){O=H.histogramRotate(O)}am.push(O)}am.splice(Q,1);if(g.blob_console_debug){p("Large blob divided")}}while(am.length>g.exact_characters){var T=0;var I=am[0].orig_width;for(var aj=1;aj<am.length;aj++){if(am[aj].orig_width<I){I=am[aj].orig_width;T=aj}}am.splice(T,1);if(g.blob_console_debug){p("Small blob removed")}}}if(typeof ae!=="undefined"&&ae.length){for(var aj=0;aj<am.length;aj++){if(g.blob_console_debug){p("Blob size = "+aa)}var ak=document.createElement("img");ak.src=am[aj].toDataURL();document.getElementById(ae).appendChild(ak)}}return am},histogramRotate:function(I){var Q=new Image();Q.src=I.toDataURL();var P=90;var M=5;var N=I;var K=I.width;for(var L=-P/2;L<=P/2;L+=M){var S=document.createElement("canvas");var R=S.getContext("2d");S.width=I.width;S.height=I.height;R.save();R.translate(I.width/2,I.height/2);R.rotate(L*Math.PI/180);R.drawImage(Q,-Q.width/2,-Q.width/2);R.restore();var J=R.getImageData(0,0,S.width,S.height);var V=0;for(var U=0;U<J.width;U++){for(var T=0;T<J.height;T++){var O=U*4+T*4*J.width;if(J.data[O]!=255&&J.data[O+3]!=0){V++;break}}}R.putImageData(J,0,0);if(V<K){K=V;N=S}}return N}};return H};var h=new Array();var B=new Array();var F=false;var i=new Array();var d=false;var w="";var x=function(G){i.push(G);if(!d){o()}};var o=function(){if(i.length){d=true;i.shift()()}else{d=false}};var m=function(I){var J=4000000000;var G="?";for(var H=0;H<h.length;H++){var K=k(h[H].pattern,I);if(K<J){J=K;G=h[H].solution}}return G};var t=function(H){var J=new Array();var L=H.getContext("2d").getImageData(0,0,H.width,H.height);for(var G=0;G<L.width;G++){for(var M=0;M<L.height;M++){var I=G*4+M*4*L.width;var K=Math.round(0.34*L.data[I]+0.5*L.data[I+1]+0.16*L.data[I+2]);if(L.data[I+3]<255){K=255}J.push(K)}}return J.join(".")};var l=function(G){var I=document.createElement("canvas");var H=I.getContext("2d");I.width=G.width;I.height=G.height;H.drawImage(G,0,0);return I};var k=function(L,K){var I=L.split(".");var H=K.split(".");var J=0;for(var G=0;G<I.length;G++){J+=(I[G]-H[G])*(I[G]-H[G])}return Math.sqrt(J/I.length)};var a=function(L,G,M,I,K,H,O){if(L<0||L>=H){return false}var P=q(G,0);var J=q(K,L);var N=I;if(E(P,N)==0){return false}else{if(E(P,J)==0){return true}}if(g.perceptive_colorspace){if(n(P,J)<=O){return true}}else{if(E(P,J)<=O){return true}}return false};var r=function(K,G,L,I,J,H,O,N,M){if(a(K,G,L,I,J,H,O)){if(typeof N!=="undefined"){if(D(N,K)){return false}}if(!(M&&J[K]==255&&J[K+1]==255&&J[K+2]==255)){J[K]=I.r;J[K+1]=I.g;J[K+2]=I.b;J[K+3]=I.a}if(typeof N!=="undefined"){N.push(K)}return true}return false};var q=function(H,G){return{r:H[G],g:H[G+1],b:H[G+2]}};var E=function(H,G){return Math.max(Math.abs(H.r-G.r),Math.abs(H.g-G.g),Math.abs(H.g-G.g))};var E=function(H,G){return Math.sqrt((Math.pow(H.r-G.r,2),Math.pow(H.g-G.g,2),Math.pow(H.g-G.g,2))/3)};var n=function(I,G){var J=function(O,M){var N=H(K(O));var L=H(K(M));return Math.sqrt(Math.pow(N.l-L.l,2)+Math.pow(N.a-L.a,2)+Math.pow(N.b-L.b,2))};var K=function(O){var M=O.r/255;var L=O.g/255;var N=O.b/255;M=M>0.04045?Math.pow((M+0.055)/1.055,2.4):(M/12.92);L=L>0.04045?Math.pow((L+0.055)/1.055,2.4):(L/12.92);N=N>0.04045?Math.pow((N+0.055)/1.055,2.4):(N/12.92);M=M*100;L=L*100;N=N*100;return{x:M*0.4124+L*0.3576+N*0.1805,y:M*0.2126+L*0.7152+N*0.0722,z:M*0.0193+L*0.1192+N*0.9505}};var H=function(O){var N=O.x/95.047;var M=O.y/100;var L=O.z/108.883;N=N>0.008856?Math.pow(N,1/3):(7.787*N)+(16/116);M=M>0.008856?Math.pow(M,1/3):(7.787*M)+(16/116);L=L>0.008856?Math.pow(L,1/3):(7.787*L)+(16/116);return{l:(116*M)-16,a:500*(N-M),b:200*(M-L)}};return J(I,G)};var D=function(G,I){for(var H=0;H<G.length;H++){if(G[H]===I){return true}}return false};var c=function(I,H,G){return{r:I,g:H,b:G,a:255}};var y=function(){var I=Math.round(Math.random()*200)+55;var H;var G;while((H=Math.round(Math.random()*200)+55)==I){}while((G=Math.round(Math.random()*200)+55)==I||G==H){}return c(I,H,G)};var j="cbl-pattern";var f="cbl-solution";var e=function(){document.getElementById("cbl-trainer").style.display="none"};var A=function(){if(document.getElementById("cbl-trainer")!=null){document.getElementById("cbl-trainer").style.display="flex"}else{var G=function(H,I){var J=document.createElement("div");J.innerHTML=I;while(J.children.length>0){H.appendChild(J.children[0])}};G(document.body,'<div id="cbl-trainer">    <div id="cbl-trainer-dialog">        <span id="cbl-close" onclick="">&cross;</span>        <h1>CBL-js Pattern Classifier</h1>        <p>Identify the character in the image below by typing it into the textbox.</p>        <p>Type <span class="cbl-discard">'+g.incorrect_segment_char+'</span> to discard a pattern if the image was not segmented properly.</p>        <div class="cbl-row">            <div class="cbl-cell-50 cbl-right">                <img id="'+j+'" />            </div>            <div class="cbl-cell-50">                <input id="'+f+'" type="text" />            </div>        </div>    </div>    <small><a href="https://github.com/skotz/cbl-js" target="_blank">CBL-js &copy; Scott Clayton</a></small></div>');document.getElementById("cbl-close").addEventListener("click",function(H){e();H.preventDefault()})}};var p=function(G){if(g.allow_console_log){console.log("CBL: "+G)}};var C=function(G){if(g.allow_console_warn){console.warn("CBL: "+G)}};var v=function(){function K(N,M){if(!H[N]){H[N]={};for(var O=0;O<N.length;O++){H[N][N.charAt(O)]=O}}return H[N][M]}var I=String.fromCharCode,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",H={},G={compressToBase64:function(N){if(null==N){return""}var M=G._compress(N,6,function(O){return L.charAt(O)});switch(M.length%4){default:case 0:return M;case 1:return M+"===";case 2:return M+"==";case 3:return M+"="}},decompressFromBase64:function(M){return null==M?"":""==M?null:G._decompress(M.length,32,function(N){return K(L,M.charAt(N))})},compressToUTF16:function(M){return null==M?"":G._compress(M,15,function(N){return I(N+32)})+" "},decompressFromUTF16:function(M){return null==M?"":""==M?null:G._decompress(M.length,16384,function(N){return M.charCodeAt(N)-32})},compressToUint8Array:function(Q){for(var O=G.compress(Q),R=new Uint8Array(2*O.length),P=0,M=O.length;M>P;P++){var N=O.charCodeAt(P);R[2*P]=N>>>8,R[2*P+1]=N%256}return R},decompressFromUint8Array:function(P){if(null===P||void 0===P){return G.decompress(P)}for(var Q=new Array(P.length/2),O=0,M=Q.length;M>O;O++){Q[O]=256*P[2*O]+P[2*O+1]}var N=[];return Q.forEach(function(R){N.push(I(R))}),G.decompress(N.join(""))},compressToEncodedURIComponent:function(M){return null==M?"":G._compress(M,6,function(N){return J.charAt(N)})},decompressFromEncodedURIComponent:function(M){return null==M?"":""==M?null:(M=M.replace(/ /g,"+"),G._decompress(M.length,32,function(N){return K(J,M.charAt(N))}))},compress:function(M){return G._compress(M,16,function(N){return I(N)})},_compress:function(O,M,P){if(null==O){return""}var V,ab,S,ac={},N={},aa="",X="",Y="",R=2,U=3,T=2,W=[],Q=0,Z=0;for(S=0;S<O.length;S+=1){if(aa=O.charAt(S),Object.prototype.hasOwnProperty.call(ac,aa)||(ac[aa]=U++,N[aa]=!0),X=Y+aa,Object.prototype.hasOwnProperty.call(ac,X)){Y=X}else{if(Object.prototype.hasOwnProperty.call(N,Y)){if(Y.charCodeAt(0)<256){for(V=0;T>V;V++){Q<<=1,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++}for(ab=Y.charCodeAt(0),V=0;8>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}else{for(ab=1,V=0;T>V;V++){Q=Q<<1|ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab=0}for(ab=Y.charCodeAt(0),V=0;16>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}R--,0==R&&(R=Math.pow(2,T),T++),delete N[Y]}else{for(ab=ac[Y],V=0;T>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}R--,0==R&&(R=Math.pow(2,T),T++),ac[X]=U++,Y=String(aa)}}if(""!==Y){if(Object.prototype.hasOwnProperty.call(N,Y)){if(Y.charCodeAt(0)<256){for(V=0;T>V;V++){Q<<=1,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++}for(ab=Y.charCodeAt(0),V=0;8>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}else{for(ab=1,V=0;T>V;V++){Q=Q<<1|ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab=0}for(ab=Y.charCodeAt(0),V=0;16>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}R--,0==R&&(R=Math.pow(2,T),T++),delete N[Y]}else{for(ab=ac[Y],V=0;T>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}}R--,0==R&&(R=Math.pow(2,T),T++)}for(ab=2,V=0;T>V;V++){Q=Q<<1|1&ab,Z==M-1?(Z=0,W.push(P(Q)),Q=0):Z++,ab>>=1}for(;;){if(Q<<=1,Z==M-1){W.push(P(Q));break}Z++}return W.join("")},decompress:function(M){return null==M?"":""==M?null:G._decompress(M.length,32768,function(N){return M.charCodeAt(N)})},_decompress:function(T,U,aa){var P,X,Q,S,O,ac,ad,W,Z=[],Y=4,ab=4,V=3,N="",M=[],R={val:aa(0),position:U,index:1};for(X=0;3>X;X+=1){Z[X]=X}for(S=0,ac=Math.pow(2,2),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}switch(P=S){case 0:for(S=0,ac=Math.pow(2,8),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}W=I(S);break;case 1:for(S=0,ac=Math.pow(2,16),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}W=I(S);break;case 2:return""}for(Z[3]=W,Q=W,M.push(W);;){if(R.index>T){return""}for(S=0,ac=Math.pow(2,V),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}switch(W=S){case 0:for(S=0,ac=Math.pow(2,8),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}Z[ab++]=I(S),W=ab-1,Y--;break;case 1:for(S=0,ac=Math.pow(2,16),ad=1;ad!=ac;){O=R.val&R.position,R.position>>=1,0==R.position&&(R.position=U,R.val=aa(R.index++)),S|=(O>0?1:0)*ad,ad<<=1}Z[ab++]=I(S),W=ab-1,Y--;break;case 2:return M.join("")}if(0==Y&&(Y=Math.pow(2,V),V++),Z[W]){N=Z[W]}else{if(W!==ab){return null}N=Q+Q.charAt(0)}M.push(N),Z[ab++]=Q+N.charAt(0),Y--,Q=N,0==Y&&(Y=Math.pow(2,V),V++)}}};return G}();"function"==typeof define&&define.amd?define(function(){return v}):"undefined"!=typeof module&&null!=module&&(module.exports=v);if(g.model_file.length){u.loadModel(g.model_file)}else{if(g.model_string.length){u.loadModelString(g.model_string)}}return u};